---
title: Network Compression
date: 2020-12-16
tags:
	- ML
	- note
	- Next-Step-of-ML
categories:
  - æå®æ¯…æœºå™¨å­¦ä¹ ç¬”è®°
---

# Network Compression

åšç½‘ç»œå‹ç¼©çš„åŸå› æ˜¯è¿™æ ·ï¼šæˆ‘ä»¬æœªæ¥å¸Œæœ›æŠŠnetwork æ”¾åˆ°å¾ˆå¤šçš„è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œè¿™äº›è®¾å¤‡ä¸Šå­˜å‚¨ç©ºé—´æœ‰é™ï¼Œè®¡ç®—èƒ½åŠ›æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›èƒ½æŠŠç½‘ç»œåšå‹ç¼©ï¼Œè€Œå°½å¯èƒ½å°çš„æŸå¤±å…¶å‡†ç¡®åº¦ï¼Œä»¥é€‚åº”è¿™äº›è®¾å¤‡ã€‚

![image-20201215183624702](images/image-20201215183624702.png)

## Outline

å…ˆåˆ—ä¸€ä¸‹æœ¬èŠ‚çš„å¤§çº²ï¼š

- Network Pruning 

- Knowledge Distillation 

- Parameter Quantization

- Architecture Design

- Dynamic Computation

å¦å¤–ï¼Œæˆ‘ä»¬ä¸ä¼šè®¨è®ºç¡¬ä»¶åŠ é€Ÿå’Œä¼˜åŒ–ç›¸å…³çš„å†…å®¹ã€‚



## Network Pruning

Network Pruningï¼ˆç½‘ç»œä¿®å‰ªï¼‰å°±æ˜¯æŠŠä¸€ä¸ªå¤§çš„network æŠŠä¸€äº›neuron å»æ‰ï¼Œä»¥è¾¾åˆ°network compression çš„ç›®çš„ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½åšåˆ°è¿™ä»¶äº‹ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬é€šå¸¸è®­ç»ƒå‡ºæ¥çš„ç¥ç»ç½‘ç»œæ˜¯over-parameterizedï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘ç»œä¸­çš„å¾ˆå¤šå‚æ•°æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦é‚£ä¹ˆå¤šå‚æ•°å°±èƒ½è§£å‡ºå½“å‰çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬ç»™äº†ç½‘ç»œè¿‡å¤šçš„å‚æ•°ã€‚å¦‚æœä½ å»åˆ†æè®­å‡ºæ¥çš„network ä¸­çš„å‚æ•°ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šçš„neuron çš„output æ€»æ˜¯0ï¼Œæœ‰äº›weight æ˜¯éå¸¸æ¥è¿‘0çš„ï¼Œè¿™äº›å‚æ•°æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚æˆ‘ä»¬å°±æŠŠè¿™äº›æ²¡ç”¨çš„ä¸œè¥¿å‰ªæ‰ã€‚

è¿™ä¸ªæ¦‚å¿µæ˜¯éå¸¸å¤è€çš„ï¼Œåœ¨90så°±å·²ç»æœ‰äº†è¿™æ ·çš„æƒ³æ³•ï¼š

![image-20201215190444564](images/image-20201215190444564.png)

![image-20201215190413673](images/image-20201215190413673.png)

Optimal Brain Damage æ„æ€æ˜¯æœ€ä¼˜è„‘æŸä¼¤ï¼Œä½ å¯ä»¥åœ¨ç›´è§‰ä¸Šçš„è¿™æ ·è€ƒè™‘ï¼Œæœºå™¨åšNetwork Pruning å°±å¥½åƒäººç±»çš„å¤§è„‘å‘è‚²ä¸­çš„ä¸€ä¸ªç°è±¡ï¼šå¦‚ä¸Šå›¾æ‰€ç¤ºäººç±»åœ¨å‡ºç”Ÿæ—¶å€™è„‘ä¸­ç¥ç»è¿æ¥æ˜¯æ¯”è¾ƒå°‘çš„åœ¨å‘è‚²çš„è¿‡ç¨‹ä¸­ç»å†äº†å¢åŠ åˆ**å‡å°‘**çš„è¿‡ç¨‹ã€‚



### weight/neuron pruning

![image-20201215195101562](images/image-20201215195101562.png)

åšweight pruning çš„è¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆè¦æœ‰ä¸€ä¸ªè®­ç»ƒå¥½çš„network ï¼Œç„¶åè¯„ä¼°æ¯ä¸ªå‚æ•°ï¼ˆneuronæˆ–weightï¼‰çš„é‡è¦æ€§ã€‚é‚£æ€ä¹ˆè¯„ä¼°å‚æ•°é‡è¦æ€§å‘¢ï¼Œå·²ç»æœ‰å¾ˆå¤šçš„è¯„ä¼°æ–¹æ³•è¢«æå‡ºæ¥äº†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºweight çš„é‡è¦æ€§æˆ‘ä»¬å¯ä»¥ä¹‹é—´çœ‹ä»–çš„æ•°å€¼å¤§å°ï¼Œå¦‚æœä»–çš„å€¼å¾ˆæ¥è¿‘é›¶å°±å¯èƒ½æ˜¯ä¸é‡è¦çš„weightï¼Œå¦‚æœå®ƒçš„ç»å¯¹å€¼å¾ˆå¤§å°±å¯èƒ½æ˜¯é‡è¦çš„å‚æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡è®¡ç®—weightçš„L1ï¼ŒL2çš„æ•°å€¼æ¥çœ‹å®ƒæ˜¯ä¸æ˜¯é‡è¦çš„ï¼›å¯¹äºneuron çš„é‡è¦æ€§ï¼Œä½ ç»™network ä¸€æ‰¹æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªneuron çš„è¾“å‡ºå‡ ä¹éƒ½æ˜¯é›¶çš„è¯ï¼Œè¿™ä¸ªneuron å°±å¯èƒ½æ˜¯ä¸é‡è¦çš„ã€‚

æ¥ä¸‹æ¥ï¼Œä½ å°±æ ¹æ®é‡è¦æ–°æ’åºweight æˆ–è€…neuron ç„¶åå»é™¤ä¸é‡è¦çš„ï¼Œä½ å°±åšå¥½çš„è£å‰ªçš„åŠ¨ä½œã€‚ç„¶åï¼Œä½ è¦åšä¸€æ¬¡fine-tuneï¼Œå»ä¿®è¡¥ä½ åšè£å‰ªçš„æ—¶å€™æŸå¤±çš„å‡†ç¡®åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¿®è¡¥ä½ åšè£å‰ªå¯¹æ¨¡å‹é€ æˆçš„æŸä¼¤ã€‚æ¥ç€ï¼Œä½ å°±çœ‹çœ‹å½“å‰è¿™ä¸ªæ¨¡å‹çš„å¤§å°å’Œå‡†ç¡®åº¦ä½ æ˜¯ä¸æ˜¯æ»¡æ„ï¼Œå¦‚æœæ»¡æ„çš„è¯ç½‘ç»œå‹ç¼©å°±ç»“æŸï¼Œå¦åˆ™ä½ å°±å›å»æ­¥éª¤äºŒé‡æ–°è¯„ä¼°é‡è¦æ€§ï¼Œä»¥æ­¤ç±»æ¨ã€‚

è¿™é‡Œæœ‰ä¸ªä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œé€šå¸¸æ¥è¯´ä½ åœ¨æ¯æ¬¡prune çš„æ—¶å€™éƒ½æ˜¯è£å‰ªæ‰ä¸€ç‚¹ç‚¹ï¼Œè¿™æ ·è¿­ä»£å¤šæ¬¡ï¼Œè€Œä¸è¦ä¸€æ¬¡prune å¤ªå¤šä»¥è‡³äºé€ æˆæ²¡åŠæ³•ä¿®è¡¥çš„æŸä¼¤ã€‚

å…³äºnetwork pruning çš„åšæ³•å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæ¥ä¸‹æ¥æˆ‘è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š



### Why Pruning?

æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åšnetwork pruning ï¼Œæˆ‘æ˜¯è¯´æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥train ä¸€ä¸ªæ›´å°çš„ç½‘ç»œï¼Ÿ

- å°çš„ç¥ç»ç½‘ç»œæ¯”è¾ƒéš¾è®­

- å¤§çš„ç¥ç»ç½‘ç»œæ›´å®¹æ˜“ä¼˜åŒ–ï¼Ÿ https://www.youtube.com/watch?v=_VuWvQUMQVk 

- Lottery Ticket Hypothesisï¼ˆå¤§ä¹é€å‡è®¾ï¼‰
  - https://arxiv.org/abs/1803.03635

ç¬¬ä¸€ç‚¹æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¼—æ‰€å‘¨çŸ¥å°çš„ç¥ç»ç½‘ç»œæ¯”è¾ƒéš¾è®­ã€‚

å¤§çš„ç¥ç»ç½‘ç»œæ›´å®¹æ˜“ä¼˜åŒ–ï¼ŒåŸå› å°±æ˜¯å¤§çš„ç¥ç»ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å¡åœ¨local minimaã€saddle point è¿™äº›ç‚¹ä¸Šã€‚è¿™ä¹Ÿè®¸å°±æ˜¯ä¸ºä»€ä¹ˆå°çš„network æ¯”è¾ƒéš¾train çš„åŸå› ã€‚æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©train å¥½ä¸€ä¸ªå¤§çš„network å†åšpruning ã€‚

å…³äºå¤§ä¹é€å‡è®¾ï¼Œæˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ï¼š

#### Lottery Ticket Hypothesis

![image-20201215203409021](images/image-20201215203409021.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†train å¥½çš„ä¸€ä¸ªå¤§network è¿›è¡Œpruning å¾—åˆ°ä¸€ä¸ªå°çš„network å¦‚å³ä¸Šè§’æ‰€ç¤ºï¼Œæˆ‘ä»¬éšæœºåˆå§‹åŒ–è¿™ä¸ªå°ç½‘ç»œçš„å‚æ•°ï¼Œé‡æ–°è®­ç»ƒè¿™ä¸ªå°çš„ç½‘ç»œï¼Œå‘ç°train ä¸èµ·æ¥ã€‚æˆ‘ä»¬å†æŠŠä¸Šè¿°ç´«è‰²çš„pruned çš„network è®¾ä¸ºæœ€åˆå§‹çš„å‚æ•°ï¼Œé‡æ–°è®­ç»ƒå°ç½‘ç»œï¼Œå‘ç°train èµ·æ¥äº†ã€‚

æ ¹æ®è¿™ä¸ªç°è±¡ï¼Œä½œè€…æå‡ºäº†å¤§ä¹é€å‡è¯´ï¼Œå°±æ˜¯è¯´train network å°±åƒä¹°ä¹é€ä¸€æ ·ï¼Œä¸åŒçš„random initialized parameters å¾—åˆ°ä¸åŒçš„åˆå§‹ç¥ç»ç½‘ç»œï¼Œæœ‰çš„train å¾—èµ·æ¥æœ‰çš„åˆ™ä¸è¡Œã€‚ä¸€ä¸ªå·¨å¤§çš„network æ˜¯ç”±å¾ˆå¤šå°çš„network ç»„æˆï¼Œè¿™äº›å°çš„network å°±æœ‰çš„èƒ½train èµ·æ¥æœ‰çš„ä¸è¡Œï¼Œè€Œå¤§çš„network ä¸­åªè¦æœ‰ä¸€ä¸ªå°çš„network èƒ½train èµ·æ¥ï¼Œæ•´ä¸ªå¤§çš„network å°±train èµ·æ¥ã€‚æ‰€ä»¥ä½ å¯ä»¥ç›´è§‰ä¸Šè¿™æ ·æƒ³ï¼Œå¤§çš„network å°±ç›¸å½“äºä½ ä¸€æ¬¡ä¹°äº†å¾ˆå¤šä¹é€ï¼Œå¢åŠ ä¸­å¥–å‡ ç‡ã€‚ç„¶åä½ å†æŠŠå¤§çš„network åšpruning æ‰¾å‡ºé‚£ä¸ªèƒ½train èµ·æ¥çš„å°çš„network ï¼Œè¿™ä¸ªå°çš„network æœ€å¼€å§‹åˆå§‹çš„å‚æ•°æ˜¯èƒ½ä½¿å®ƒè¢«train èµ·æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°äº†ä¸Šå›¾æ‰€è¿°çš„ç°è±¡ã€‚



ä¸‹é¢æ˜¯ä¸€ä¸ªä¸ä¸Šè¿°å¯¹ç«‹çš„çœ‹æ³•ã€‚

#### Rethinking the Value of Network Pruning

> https://arxiv.org/abs/1810.05270

è¿™ç¯‡æ–‡ç« ä¸»è¦å°±æ˜¯è®²å°çš„network ä¹Ÿæ˜¯train çš„èµ·æ¥çš„ã€‚

![image-20201216094741677](images/image-20201216094741677.png)

è¿™ä¸ªæ–‡ç« çš„å®éªŒä¸­çš„éšæœºåˆå§‹åŒ–å‚æ•°å°±æ˜¯çœŸçš„éšæœºåˆå§‹åŒ–å‚æ•°ï¼Œè€Œä¸æ˜¯ä»åŸå§‹æ¨¡å‹çš„åˆå§‹åŒ–å‚æ•°copy è¿‡æ¥ã€‚

ä¸Šå›¾æ˜¯å®éªŒç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”Unpruned å’ŒFine-tuned ä¸¤åˆ—ï¼Œä¼¼ä¹å°±æ˜¯pruned network ä¹Ÿæ˜¯train çš„èµ·æ¥çš„ã€‚



æ‰€ä»¥è¯´ï¼Œä¸Šè¿°è¿™ä¸¤ç¯‡paper çš„ç»“è®ºå°±æ˜¯çŸ›ç›¾å¯¹ç«‹çš„ï¼Œä¸¤ç¯‡æ–‡ç« éƒ½æ˜¯å‘è¡¨åœ¨ICLR ï¼Œä¸”æ˜¯open review çš„ï¼Œç½‘ç»œä¸Šæœ‰reviewer é—®åˆ°ä¸¤ç¯‡paper çš„å¯¹ç«‹è§‚ç‚¹ï¼Œä»–ä»¬çš„ä½œè€…ä¹Ÿéƒ½å¯¹æ­¤åšäº†ä¸€äº›è§£é‡Šï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæœç´¢ã€‚



### Network Pruning-Practical Issue

Network Pruning æœ‰ä¸€äº›å®ä½œä¸Šçš„é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ï¼Œæˆ‘ä»¬ä¸Šé¢è¯´ä½ å¯ä»¥è¡¡é‡weight æˆ–è€…neuron çš„é‡è¦æ€§ï¼Œç„¶åprune æ‰ä¸é‡è¦çš„ï¼Œé‚£weight å’Œneuron ä¸¤è€…pruneå“ªä¸ªæ¯”è¾ƒå¥½å‘¢ã€‚

å¦‚æœæˆ‘ä»¬prune weightï¼š

![image-20201216100228211](images/image-20201216100228211.png)

ä½ prune æ‰ä¸é‡è¦çš„weight åï¼Œä½ å¾—åˆ°çš„ç½‘ç»œæ¶æ„æ˜¯ä¸è§„åˆ™çš„ï¼Œæ‰€è°“ä¸è§„åˆ™æ˜¯è¯´ï¼Œåœ¨åŒä¸€å±‚ä¸­æœ‰çš„neuron åƒä¸¤ä¸ªinput æœ‰çš„åƒå››ä¸ªinputï¼Œè¿™æ ·çš„ç½‘ç»œçš„ç®—æ³•ç¨‹åºä½ æ¯”è¾ƒéš¾å®ç°ï¼Œå°±ç®—ä½ çœŸçš„å®ç°äº†è¿™ç§ç®—æ³•ï¼Œä½ ä¹Ÿä¸å¥½ç”¨GPU åŠ é€ŸçŸ©é˜µè¿ç®—ã€‚

æ‰€ä»¥å®ä½œä¸Šä½ åšweight pruning çš„è¯ä½ å°±ä¼šæŠŠweight è®¾é›¶ï¼Œè€Œä¸æ˜¯æ‹¿æ‰weightï¼Œä½†æ˜¯è¿™ä¹ˆåšä½ å¹¶æ²¡æœ‰å®é™…ä¸Šä¸¢æ‰weightï¼Œæ¨¡å‹çš„å¤§å°æ˜¯æ²¡æœ‰å˜çš„ï¼Œæ‰€ä»¥è¿™ä¸èƒ½è¾¾åˆ°æˆ‘ä»¬çš„network compression çš„ç›®çš„ã€‚

![image-20201216100654365](images/image-20201216100654365.png)

> https://arxiv.org/pdf/1608.03665.pdf

ç´«è‰²çº¿æ˜¯æˆ‘ä»¬prune çš„é‡ï¼Œå‡ ä¹éƒ½åœ¨95%ä»¥ä¸Šã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°prune ä»¥åï¼Œé›†ä¸­æ¨¡å‹çš„é€Ÿåº¦å¤§éƒ¨åˆ†éƒ½æ˜¯æœ‰æ‰€ä¸‹é™çš„ã€‚æ‰€ä»¥å¾—ä¸å¿å¤±ï¼Œä½ ä»¥ä¸ºprune ä»¥åä¼šæ›´å¿«ï¼Œä½†å®é™…ä¸Šå˜å¾—æ›´æ…¢äº†ã€‚

æ‰€ä»¥è¯´prune neuron æ˜¯æ¯”è¾ƒå¥½å®ä½œä¹Ÿæ¯”è¾ƒå¥½åŠ é€Ÿçš„ï¼š

![image-20201216101700269](images/image-20201216101700269.png)



## Knowledge Distillation

![image-20201216101758182](images/image-20201216101758182.png)

> Knowledge Distillation
>
> https://arxiv.org/pdf/1503.02531.pdf
>
> Do Deep Nets Really Need to be Deep?
>
> https://arxiv.org/pdf/1312.6184.pdf

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒKnowledge Distillation å°±æ˜¯ç”¨ä¸€ä¸ªå°çš„network å»å­¦ä¹ å¤§çš„network çš„è¡Œä¸ºã€‚æˆ‘ä»¬ä¸æ˜¯è¾ƒStudent Net æ­£ç¡®çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯å‘Šè¯‰ä»–å½“å‰è¾“å…¥å¯èƒ½æ˜¯ä»€ä¹ˆï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå½“è¾“å…¥æ˜¯å›¾ç‰‡1çš„æ—¶å€™ï¼ŒStudent Net å»å­¦ä¹ Teacher Net çš„è¾“å‡ºï¼Œå®ƒä¼šå­¦åˆ°å½“å‰å›¾ç‰‡æœ‰0.7çš„å¯èƒ½æ€§æ˜¯1ï¼Œæœ‰0.2çš„å¯èƒ½æ€§æ˜¯7ï¼Œæœ‰0.1çš„å¯èƒ½æ€§æ˜¯9ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒStudent Net ä¸ä»…ä¼šå­¦ä¹ åˆ°å½“å‰è¾“å…¥çš„å›¾ç‰‡å¯èƒ½æ˜¯ä»€ä¹ˆï¼Œå®ƒè¿˜ä¼šå­¦ä¹ åˆ°1å’Œ7å’Œ9æ˜¯ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥è¿™æ ·çš„å­¦ä¹ æ–¹å¼æ˜¯å¯ä»¥å­¦ä¹ åˆ°æ›´ä¸°å¯Œçš„ä¿¡æ¯çš„ã€‚æ‰€ä»¥ï¼Œæœ‰å¯èƒ½å³ä½¿Student Net æ²¡è§è¿‡å›¾ç‰‡7ï¼Œå®ƒåªè§è¿‡å›¾ç‰‡1å’Œ9ï¼Œä½†æ˜¯è¿™ä¹ˆå­¦å®Œä»¥åå®ƒæ˜¯å¯ä»¥è§¦ç±»æ—é€šçš„è®¤å‡º7çš„ã€‚

![image-20201216103256529](images/image-20201216103256529.png)

Knowledge Distillation çš„ä¸€ä¸ªç”¨å¤„æ˜¯ç”¨ä¸€ä¸ªå°çš„Student Net æ¨¡æ‹Ÿä¸€ä¸ªå·¨å¤§çš„ensemble çš„Teacher Net ã€‚é€šå¸¸æ¥è¯´ensemble çš„æ–¹æ³•å¯ä»¥è®©ä½ çš„æ¨¡å‹çš„å‡†ç¡®åº¦æ›´ä¸Šä¸€å±‚æ¥¼ï¼Œä½†æ˜¯è¿™ä¹ˆåšæ˜¯ç‰ºç‰²äº†ç®—åŠ›å’Œç©ºé—´çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨Knowledge Distillation çš„æ–¹æ³•ï¼Œç”¨ä¸€ä¸ªå°çš„network æ¨¡æ‹Ÿå¤§çš„ensemble network è¾¾åˆ°ç›¸è¿‘çš„å‡†ç¡®åº¦ã€‚



### Temperature

åœ¨Knowledge Distillation çš„å®ä½œä¸Šæœ‰ä¸€ä¸ªæŠ€å·§å«åšTemperatureï¼š

![image-20201216103546093](images/image-20201216103546093.png)

Temperature å°±æ˜¯å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨åšclassification çš„network çš„æœ€åä¼šæœ‰ä¸€ä¸ªsoftmax layer ï¼Œsoftmax layer å°±æ˜¯ä¼šæŠŠnetwork outputçš„å€¼å–Exponential ç„¶ååšä¸€ä¸ªnormalizeã€‚æˆ‘ä»¬é€šå¸¸ä¼šåœ¨åšsoftmax ä¹‹å‰å¯¹network çš„output åšé™¤ä¸Štemperature çš„åŠ¨ä½œï¼Œtemperature é€šå¸¸æ˜¯ä¸€ä¸ªå¤§äº1çš„å€¼ã€‚

ä¸ºä»€ä¹ˆè¿™æ ·åšå‘¢ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“Knowledge Distillation ä¹‹æ‰€ä»¥ä¼šæœ‰ç”¨æ˜¯å› ä¸ºå¤§çš„network çš„è¾“å‡ºæ˜¯å¯èƒ½æ€§ï¼Œè€Œä¸æ˜¯one-hot çš„å‘é‡ï¼Œå¦‚æœæ˜¯åè€…é‚£å°±å¤±å»äº†ä¸åŒclass ä¹‹é—´çš„ç›¸ä¼¼æ€§ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸ºäº†è®©ä¸åŒçš„label ä¹‹é—´çš„åˆ†æ•°æ‹‰è¿‘ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±é™¤ä¸Štemperatureã€‚æœ¬æ¥çš„xé€šè¿‡softmax layer å¾—åˆ°çš„yçš„åä¸¤ä¸ªç»´åº¦éƒ½æ¥è¿‘0ï¼Œè€Œxé™¤ä¸Štemperature åé€šè¿‡softmax layer å¾—åˆ°çš„yçš„å„ä¸ªç»´åº¦ä¹‹é—´çš„åˆ†æ•°å°±è¢«æ‹‰è¿‘äº†ã€‚

ä½†æ˜¯ï¼Œåœ¨å®é™…ä¸ŠKnowledge Distillation æ²¡æœ‰ç‰¹åˆ«æœ‰ç”¨ã€‚ğŸ¤£



## Parameter Quantization

å‚æ•°é‡åŒ–ï¼Œè¿™ä¸€èŠ‚å°†åœ¨å‚æ•°ä¸Šåšä¸€ç‚¹æ–‡ç« ã€‚

1. Using less bits to represent a value

è¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯å»æ‰ä¸€äº›å‚æ•°çš„ç²¾åº¦ï¼Œæ¥æ¢å–å­˜å‚¨ç©ºé—´çš„ä¸‹é™ã€‚

2. Weight clustering 

![image-20201216104758315](images/image-20201216104758315.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒWeight clustering å°±æ˜¯å°†ç›¸è¿‘çš„å‚æ•°èšç°‡ï¼Œç„¶åç”¨ä¸€ä¸ªæ˜ å°„è¡¨æ¥å­˜å‚¨ï¼Œä»¥é™ä½å‚æ•°å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ä¸€ä¸ªcluster ä¸­çš„å‚æ•°å¯ä»¥å–å‡å€¼ä½œä¸ºè¿™ä¸ªcluster çš„å€¼ã€‚è¿™æ ·åšä½ ä¹Ÿæ˜¯ä¼šæŸå¤±ä¸€äº›è¿›åº¦ï¼Œä½†æ˜¯æ¢æ¥äº†å¾ˆå¥½çš„æ¨¡å‹å‹ç¼©ç‡ã€‚

3. Represent frequent clusters by less bits, represent rare clusters by more bits 

æ›´è¿›ä¸€æ­¥ï¼Œä½ å°±å¯ä»¥æŠŠå¸¸è§çš„clusters ç”¨æ¯”è¾ƒçŸ­çš„coding è¡¨ç¤ºï¼Œæ¯”è¾ƒç½•è§çš„clusters ç”¨æ¯”è¾ƒé•¿çš„coding è¡¨ç¤ºï¼Œä»¥è¿›ä¸€æ­¥æé«˜æ¨¡å‹å‹ç¼©ç‡ã€‚æ¯”å¦‚ä½¿ç”¨å“ˆå¤«æ›¼ç¼–ç ã€‚



### Binary Weights

Parameter Quantization è¿™ç§æ€æƒ³å’Œæ–¹æ³•çš„æè‡´å°±æ˜¯ä½ å¯ä¸å¯ä»¥åªç”¨+-1æ¥è¡¨ç¤ºä¸€ä¸ªweightã€‚å…¶å®æ–‡çŒ®ä¸Šæœ‰ä¸€äº›å°è¯•æ˜¯å¯ä»¥ç›´æ¥train binary  weight çš„networkï¼Œæœ€æ—©çš„ä¸€ç¯‡paper å°±æ˜¯ä¸‹é¢è¿™ä¸ªBinary Connect ã€‚

![image-20201216105206155](images/image-20201216105206155.png)

> Binary Connect: https://arxiv.org/abs/1511.00363 
>
> Binary Network:
>
> https://arxiv.org/abs/1602.02830
>
> XNOR-net: 
>
> https://arxiv.org/abs/1603.05279

Binary Weights çš„ç²¾ç¥å°±æ˜¯ä½ çš„å‚æ•°æ˜¯äºŒå…ƒåŒ–çš„ç”¨+-1æ¥è¡¨ç¤ºã€‚ä¸Šå›¾ç°è‰²çš„ç‚¹ä»£è¡¨å‚æ•°ç©ºé—´ï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªbinary weight çš„networkï¼Œè¿™ä¸ªnetwork ä¸­æ‰€æœ‰å‚æ•°éƒ½æ˜¯äºŒå…ƒåŒ–çš„éƒ½æ˜¯+1æˆ–è€…-1ã€‚

ç„¶åä½ å°±åˆå§‹ä¸€ç»„å‚æ•°ï¼Œè¿™ç»„å‚æ•°å¯ä»¥æ˜¯real value çš„ï¼Œä½ å°±ç°æ ¹æ®å½“å‰network çš„å‚æ•°æ‰¾ä¸€ä¸ªæœ€æ¥è¿‘çš„binary weight çš„network å»è®¡ç®—gradient ï¼Œæ ¹æ®è¿™ä¸ªgradient æ›´æ–°å½“å‰network çš„å‚æ•°ï¼Œç„¶åå†å»æ ¹æ®æ›´æ–°åçš„network æ‰¾ä¸€ä¸ªæœ€æ¥è¿‘çš„binary weight çš„network å»è®¡ç®—gradient ï¼Œæ ¹æ®è¿™ä¸ªgradient æ›´æ–°å½“å‰network çš„å‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚

è¿™ä¸ªBinary Connect æ ¹æ®æ–‡çŒ®ä¸Šçš„ç»“æœçœ‹èµ·æ¥è¿˜ä¸é”™ï¼š

![image-20201216105935627](images/image-20201216105935627.png)

> https://arxiv.org/abs/1511.00363

ä»ä¸Šé¢æ¥çœ‹ï¼ŒBinary Connect å±…ç„¶è¿˜æ¯”åŸæ¥çš„network çš„ç»“æœè¿˜è¦å¥½ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿä½ å¯ä»¥è¿™æ ·æƒ³ï¼ŒBinary Connect å¯ä»¥çœ‹ä½œåœ¨åšregularization ï¼Œå®ƒé™åˆ¶å‚æ•°çš„å€¼åªèƒ½æ˜¯+-1ã€‚åªæ˜¯è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯æ²¡æœ‰åšDropout æ›´å¥½å°±æ˜¯äº†ã€‚



## Architecture Design

è°ƒæ•´network çš„æ¶æ„è®¾è®¡è®©å®ƒå˜å¾—åªéœ€è¦è¾ƒå°‘çš„å‚æ•°ï¼Œä»¥å®ç°network compression ã€‚è¿™ä¹Ÿè®¸æ˜¯ç°åœ¨å®ä½œä¸Šæœ€æœ‰æ•ˆçš„åšæ³•ã€‚

å…ˆæ¥çœ‹çœ‹fully connected network ï¼š

### Fully Connected Network

#### Low rank approximation

![image-20201216121231803](images/image-20201216121231803.png)

å¦‚ä¸Šå›¾å·¦ä¸Šè§’ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªnetwork ï¼Œå…¶ä¸­Mã€Nä¸¤å±‚ä¸­é—´æœ‰å‚æ•°Wï¼Œè¿™ä¸¤å±‚åˆ†åˆ«å„æœ‰Mã€Nä¸ªneuronï¼Œç„¶åæˆ‘ä»¬åœ¨è¿™ä¸¤å±‚ä¸­é—´åŠ ä¸€ä¸ªneuronæ¯”è¾ƒå°‘çš„linear hidden layer Kï¼Œä½ ä»”ç»†æƒ³æƒ³çœ‹ï¼Œè¿™æ ·åšå‚æ•°å…¶å®æ˜¯å˜å°‘äº†ã€‚

åŸå…ˆæœ‰$M\times N$é‚£ä¹ˆå¤šå‚æ•°ï¼Œç„¶åå˜æˆ$M\times K+K\times N$ ä¸ªå‚æ•°ã€‚å¦‚æœæˆ‘ä»¬è°ƒæ§å¥½Kçš„å€¼ï¼Œå°±å¯ä»¥åšåˆ°å‡å°‘å‚æ•°çš„æ•ˆæœã€‚

ä½†æ˜¯è¿™ä¸ªtrick ä¼šå¯¹network æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚



### CNN-network compression

#### Review: Standard CNN

![image-20201216122025893](images/image-20201216122025893.png)

å¦‚æœæˆ‘ä»¬çš„input æœ‰ä¸¤ä¸ªchannel ï¼Œæˆ‘ä»¬çš„filter å°±è¦å¯¹åº”æœ‰ä¸¤ä¸ªï¼Œå¦‚ä¸Šå›¾ä¸­é—´æ‰€ç¤ºï¼Œæˆ‘ä»¬é€šå¸¸æœ‰å¤šä¸ªfilter æ¯”å¦‚4ä¸ªçš„è¯ï¼Œè¿™æ ·æˆ‘ä»¬å¾—åˆ°çš„output å°±æ˜¯å››ä¸ªï¼Œå¦‚å›¾å³è¾¹æ‰€ç¤ºã€‚æ‰€ä»¥è¿™ä¸ªCNN çš„filter çš„å‚æ•°ä¸ªæ•°æ˜¯72ä¸ªï¼Œåé¢æˆ‘ä»¬è¦åšnetwork compression çœ‹çœ‹èƒ½ä»72å‡å°‘åˆ°å¤šå°‘ã€‚

#### Depthwise Separable Convolution

![image-20201216122507677](images/image-20201216122507677.png)

Depthwise Separable Convolution æ˜¯æŠŠconvolutionæ‹†æˆä¸¤ä¸ªæ­¥éª¤ï¼š

1. step1 **Depthwise Convolution**

- filter æ•°é‡=è¾“å‡ºçš„channel
- æ¯ä¸ªfilter éƒ½åªå¤„ç†ä¸€ä¸ªchannel
- filter æ˜¯k*k çš„çŸ©é˜µ
- ä¸åŒçš„channel ä¹‹é—´äº’ç›¸æ²¡æœ‰å½±å“çš„

è¿™æ ·æ¯ä¸ªfilter å°±ä¸å†è€ƒè™‘å…¶ä»–channel ï¼Œå·ç§¯å¾—åˆ°è¾“å‡ºæ˜¯ä¸¤å±‚

![image-20201216123027416](images/image-20201216123027416.png)

2. step2 **Pointwise Convolution** 

![image-20201216123059747](images/image-20201216123059747.png)

ç¬¬äºŒæ­¥éª¤ï¼Œæ˜¯è¯´æ¯ä¸ªfilter éƒ½åªç”¨ä¸€ä¸ªvalue ï¼Œç”¨è¿™æ ·çš„filter å»å¤„ç†ç¬¬ä¸€æ­¥å¾—åˆ°çš„ä¸¤å±‚è¾“å‡ºï¼Œè¿™ä¸€æ­¥çš„è¾“å‡ºå°±å’Œç»å…¸çš„CNN çš„å·ç§¯è¾“å‡ºç›¸åŒäº†ã€‚

ç»¼åˆè¿™ä¸¤æ­¥ï¼Œfilter çš„å‚æ•°æ€»é‡æ˜¯24ã€‚



ä¸‹é¢æ¥è§£é‡Šä¸€ä¸‹ï¼Œè¿™ä¸ªæ‹†è§£çš„æ­¥éª¤å’ŒåŸæ¥çš„CNN æœ‰ä»€ä¹ˆæ ·çš„å…³ç³»ã€‚

![image-20201216123643864](images/image-20201216123643864.png)

ä¸Šå›¾ä¸Šä¾§æ˜¯ä¸€èˆ¬çš„CNN çš„å·ç§¯è¿‡ç¨‹ã€‚

ä¸‹ä¾§æ˜¯Depthwise Separable Convolution ï¼Œè§‚å¯Ÿå·ç§¯è¿‡ç¨‹ï¼Œç¬¬ä¸€æ­¥å°†å¾—åˆ°ä¸­é—´äº§ç‰©ä¸¤å±‚çš„è¾“å‡ºï¼Œç„¶åç»è¿‡ç¬¬äºŒæ­¥çš„æ¯ä¸ªfilter å¾—åˆ°æœ€ç»ˆè¾“å‡ºçš„æ¯ä¸€å±‚ã€‚è¿™ä¸ªè¿‡ç¨‹ä½ å¯ä»¥è¿™æ ·è€ƒè™‘ï¼Œç¬¬ä¸€æ­¥ä½¿ç”¨çš„filter å¤„ç†äº†9ä¸ªinput ï¼Œç„¶åæŠŠè¾“å‡ºç»“æœä¸¢ç»™ç¬¬äºŒæ­¥çš„filter å¤„ç†è¿™ä¸¤ä¸ªoutputï¼Œäº§ç”Ÿä¸€ä¸ªoutputã€‚è¿™ä¸ªè¿‡ç¨‹å’Œç»å…¸CNN ä¸­çš„å·ç§¯åšçš„äº‹æƒ…ç±»ä¼¼ï¼Œç»å…¸CNN ä¸­ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†18ä¸ªinput äº§ç”Ÿä¸€ä¸ªè¾“å‡ºï¼Œè€Œæˆ‘ä»¬ç°åœ¨é€šè¿‡å åŠ ä¸¤å±‚å¤„ç†è¿‡ç¨‹ï¼Œç”¨æ›´å°‘çš„å‚æ•°åšåˆ°äº†ç»å…¸CNN ä¸€å±‚å¤„ç†è¿‡ç¨‹åšåˆ°çš„äº‹ã€‚



æ¥ä¸‹æ¥ç®—ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ç†è®ºä¸Šçš„æ¨¡å‹å‹ç¼©ç¨‹åº¦ï¼š

![image-20201216124345851](images/image-20201216124345851.png)

è®¡ç®—è¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ€åç»“æœå°±æ˜¯ä»$(k\times k\times I)\times O$ ==>$k\times k\times I + I\times O$



### To learn more â€¦â€¦

> - SqueezeNet
>   - https://arxiv.org/abs/1602.07360
>
> - MobileNet
>   - https://arxiv.org/abs/1704.04861
>
> - ShuffleNet
>   - https://arxiv.org/abs/1707.01083
>
> - Xception
>   - https://arxiv.org/abs/1610.02357



## Dynamic Computation

![image-20201216125410492](images/image-20201216125410492.png)

æˆ‘ä»¬å¸Œæœ›æ¨¡å‹èƒ½è°ƒæ•´å®ƒæ‰€çš„è®¡ç®—èƒ½åŠ›ï¼Œå†èµ„æºå……è¶³çš„æ—¶å€™åŠªåŠ›åšåˆ°æœ€å¥½ï¼Œåœ¨èµ„æºç´§å¼ çš„æ—¶å€™é™ä½è®¡ç®—ç²¾åº¦ä»¥æé«˜æŒç»­æœåŠ¡çš„æ—¶é—´ã€‚æ¯”å¦‚åœ¨æ‰‹æœºå¿«æ²¡ç”µçš„æ—¶å€™è¯­éŸ³åŠ©æ‰‹çš„è¿è¡ŒåŠŸè€—çš„è°ƒæ•´ã€‚

è¿™è¾¹æ¥ä»‹ç»ä¸€äº›å¯èƒ½çš„è§£å†³æ–¹æ³•ï¼š

![image-20201216125620034](images/image-20201216125620034.png)

1. è®­ç»ƒå¤šä¸ªæ¨¡å‹ï¼Œæ ¹æ®è®¾å¤‡çš„æƒ…å†µé€‰æ‹©é€‚å½“çš„ç½‘ç»œ

ä½†æ˜¯è¿™æ ·çš„æ–¹æ³•æ¯”è¾ƒåƒå­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸å¤ªå¥½ã€‚

2. è®­ç»ƒä¸­é—´å±‚ä¹Ÿå¯ä»¥åšåˆ†ç±»å™¨çš„ç½‘ç»œ

è¿™ä¸ªåšæ³•æ˜¯è¯´ï¼Œæ­£å¸¸æƒ…å†µä¸‹é€šè¿‡æ•´ä¸ªæ¨¡å‹çš„è®¡ç®—è¾“å‡ºç»“æœï¼Œä½†æ˜¯åœ¨èµ„æºç´§å¼ çš„æƒ…å†µä¸‹æŠŠæ¨¡å‹çš„ä¸­é—´æŸäº›å±‚çš„ç»“æœç›´æ¥æ‹¿å‡ºæ¥é€šè¿‡ä¸€ä¸ªç®€å•çš„è®¡ç®—å°±å¯ä»¥å¾—åˆ°ç»“æœï¼Œä»¥æ­¤è‡ªç”±è°ƒæ•´networkçš„è¿ç®—é‡ã€‚

å¦‚æœä½ ç›´æ¥è¿™ä¹ˆåšç»“æœå¾€å¾€æ˜¯ä¸å¤ªå¥½çš„ï¼Œå› ä¸ºä½ åœ¨train æ•´ä¸ªnetwork çš„æ—¶å€™å‰é¢çš„layer å¾€å¾€æ˜¯å­¦ä¹ è¯†åˆ«å¾ˆç®€å•çš„ä¿¡æ¯ï¼Œåé¢çš„layer æ‰èƒ½ç»¼åˆè¿™äº›ä¿¡æ¯åšåˆ¤æ–­ã€‚

ä¸Šå›¾å·¦ä¸‹è§’æ˜¯ä¸­æœ‰ä¸€ä¸ªå®éªŒç»“æœï¼Œçºµè½´å°±æ˜¯å‡†ç¡®ç‡ï¼Œæ¨ªè½´ä»å·¦åˆ°å³å°±æ˜¯ä»æ¨¡å‹çš„å‰åˆ°åæŠ½å‡ºä¸­é—´ç»“æœã€‚æ˜¾è€Œæ˜“è§ï¼Œè¶Šæ·±çš„åœ°æ–¹æŠ½å‡ºçš„ä¸­é—´ç»“æœæ‰è¶Šèƒ½å‡†ç¡®çš„åšå¥½ä»»åŠ¡ã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœä½ åœ¨ä¸­é—´åŠ ä¸€äº›classifier ï¼Œè¿™äº›åˆ†ç±»å™¨æ˜¯å’Œæ•´ä¸ªnetwork ä¸€èµ·train çš„ï¼Œè¿™äº›classifier çš„è®­ç»ƒä¼šä¼¤å®³åˆ°æ•´ä¸ªnetwork çš„åŠŸèƒ½å¸ƒå±€ã€‚åŸæ¥network çš„å‰å‡ å±‚è¦æŠ½å‡ºä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œä½†æ˜¯ä½ ç°åœ¨å¼ºåŠ çš„classifier è¦æ±‚å‰å‡ å±‚åŒæ—¶èƒ½å¤Ÿç»¼åˆè¿™äº›ä¿¡æ¯ï¼Œå°±å¯¼è‡´å‰å‡ å±‚ä¸èƒ½æŠŠæ‰€æœ‰çš„æ³¨æ„åŠ›éƒ½ç”¨åœ¨æŠ½åŸºç¡€ä¿¡æ¯ä¸Šã€‚å®éªŒç»“æœå¦‚ä¸Šå›¾å³ä¸‹è§’ï¼Œä½ åœ¨æ¯”è¾ƒæµ…çš„åœ°æ–¹åŠ classifier æ•´ä¸ªnetwork çš„è¡¨ç°å°±ä¼šæš´è·Œï¼Œåœ¨é åçš„ä½ç½®åŠ classifier å¯¹network çš„å½±å“å°±ä¼šå°ä¸€äº›ã€‚

> https://arxiv.org/abs/1703.09844

æœ‰æ²¡æœ‰æ–¹æ³•èƒ½è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿæœ‰çš„ï¼š

![image-20201216130920989](images/image-20201216130920989.png)

> https://arxiv.org/abs/1703.09844

ä½ å¯ä»¥è‡ªè¡ŒæŸ¥é˜…è¿™ç¯‡paper ã€‚

